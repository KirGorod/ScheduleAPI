{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Kirill/Documents/Dev/ScheduleAPI/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Kirill/Documents/Dev/ScheduleAPI/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Kirill/Documents/Dev/ScheduleAPI/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useState,useEffect}from\"react\";import jwt_decode from\"jwt-decode\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var navigate=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(username,password){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"http://127.0.0.1:8000/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:username,password:password})});case 2:response=_context.sent;_context.next=5;return response.json();case 5:data=_context.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));navigate(\"/\",{'replace':true});}else{alert(\"Username or password is incorrect!\");}case 7:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x,_x2){return _ref2.apply(this,arguments);};}();var registerUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(username,first_name,last_name,password,password2){var response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"http://127.0.0.1:8000/api/register/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:username,first_name:first_name,last_name:last_name,password:password,password2:password2})});case 2:response=_context2.sent;console.log(JSON.stringify({username:username,first_name:first_name,last_name:last_name,password:password,password2:password2}));if(response.status===201){navigate('/login',{'replace':true});}else{alert(\"Wrong username or password...\");}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function registerUser(_x3,_x4,_x5,_x6,_x7){return _ref3.apply(this,arguments);};}();var logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");navigate(\"/\",{'replace':true});};var contextData={user:user,setUser:setUser,authTokens:authTokens,setAuthTokens:setAuthTokens,registerUser:registerUser,loginUser:loginUser,logoutUser:logoutUser};useEffect(function(){if(authTokens){setUser(jwt_decode(authTokens.access));}setLoading(false);},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"names":["createContext","useState","useEffect","jwt_decode","useNavigate","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loading","setLoading","navigate","loginUser","username","password","fetch","method","headers","body","stringify","response","json","data","status","access","setItem","alert","registerUser","first_name","last_name","password2","console","log","logoutUser","removeItem","contextData"],"sources":["C:/Users/Kirill/Documents/Dev/ScheduleAPI/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useNavigate  } from \"react-router-dom\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport default AuthContext;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [authTokens, setAuthTokens] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n  const [user, setUser] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const loginUser = async (username, password) => {\r\n    const response = await fetch(\"http://127.0.0.1:8000/api/token/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        username,\r\n        password\r\n      })\r\n    });\r\n    const data = await response.json();\r\n\r\n    if (response.status === 200) {\r\n      setAuthTokens(data);\r\n      setUser(jwt_decode(data.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n      navigate(\"/\", {'replace': true});\r\n    } else {\r\n      alert(\"Username or password is incorrect!\");\r\n    }\r\n  };\r\n  \r\n  const registerUser = async (username, first_name, last_name, password, password2) => {\r\n    const response = await fetch(\"http://127.0.0.1:8000/api/register/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        username,\r\n        first_name,\r\n        last_name,\r\n        password,\r\n        password2\r\n      })\r\n    });\r\n    console.log(JSON.stringify({\r\n      username,\r\n      first_name,\r\n      last_name,\r\n      password,\r\n      password2\r\n    }))\r\n    if (response.status === 201) {\r\n      navigate('/login', {'replace': true})\r\n    } else {\r\n      alert(\"Wrong username or password...\");\r\n    }\r\n  };\r\n\r\n  const logoutUser = () => {\r\n    setAuthTokens(null);\r\n    setUser(null);\r\n    localStorage.removeItem(\"authTokens\");\r\n    navigate(\"/\", {'replace': true});\r\n  };\r\n\r\n  const contextData = {\r\n    user,\r\n    setUser,\r\n    authTokens,\r\n    setAuthTokens,\r\n    registerUser,\r\n    loginUser,\r\n    logoutUser\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (authTokens) {\r\n      setUser(jwt_decode(authTokens.access));\r\n    }\r\n    setLoading(false);\r\n  }, [authTokens, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>\r\n      {loading ? null : children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}